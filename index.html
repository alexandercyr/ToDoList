<!DOCTYPE html>

<html>
<head>
    <title>ToDoList</title>
    <script src="js/sql.js"></script>
    <link rel="stylesheet" type="text/css" href="css/styles.css" />
    <link href="https://fonts.googleapis.com/css?family=Roboto+Slab:100,300,400" rel="stylesheet">
</head>

<body>
    <div class="background">
    <div class="container">
        <div class="header">
<h1>TO DO LIST</h1>
<button id="removeChecked">REMOVE CHECKED</button>
<button id="removeAll">REMOVE ALL</button>


<input id="newItem" type="text" placeholder="Buy Milk">
<button id="add">ADD</button>
</div>
<ul id="listToDo">
    <hr>
</ul>
</div>
    </div>
<script>
    var n = 0;
    var close = document.getElementsByClassName("close");
    var checked = document.getElementsByClassName("checked");
    var allItems = document.getElementsByTagName("LI");
    var list = document.getElementById("listToDo");
    document.getElementById('removeAll').addEventListener('click', removeAll);
    document.getElementById('add').addEventListener('click', add);
    document.getElementById('removeChecked').addEventListener('click', removeChecked);

    
    render();
    
    
    function render(){
        for (i=0; i < localStorage.length; i++){
            var retrievedObject = localStorage.getItem("task" + n);
            var task = JSON.parse(retrievedObject)
            console.log(task)
        
            while (task == null) {
                n++;
                retrievedObject = localStorage.getItem("task" + n);
            task = JSON.parse(retrievedObject);
            console.log(n);
            }

        var list = document.getElementById("listToDo");
        if (task.checked) {
            list.innerHTML += '<li class="checked" onclick="clickCheck(this)" id="'+ task.id +'"><div id="checkImg"></div><p>' + task.task +'</p><button class="close" id="remove">X</button><hr></li>';

        }
        else{
         list.innerHTML += '<li onclick="clickCheck(this)" id="'+ task.id +'"><div id="checkImg"></div><p>' + task.task +'</p><button class="close" id="remove">X</button><hr></li>';

        }
        removeButton();
        n++;
        }
    }

function toggleCheckbox(element) {
    var checkedToDo = document.getElementById(element.parentNode.id);

    if(element.checked) {
    // Checkbox is checked.
    checkedToDo.className = "checked";
    var retrievedObject = localStorage.getItem(element.parentNode.id);
    var task = JSON.parse(retrievedObject)
    task.checked = true;
    localStorage.setItem(task.id, JSON.stringify(task));

    
  } else {
    checkedToDo.className = ("unchecked");
    var retrievedObject = localStorage.getItem(element.parentNode.id);
    var task = JSON.parse(retrievedObject)
    task.checked = false;
    localStorage.setItem(task.id, JSON.stringify(task));

  }
    
}


    function add(){
        var item = document.getElementById("newItem").value;
        var list = document.getElementById("listToDo");
        if (item=="") {
            alert("You still need to enter a todo!")
        }
        else{
        var taskID = "task" + n;
        var task = {};
        task.id = taskID;
        task.task = item;
        task.checked = false;
        localStorage.setItem(taskID, JSON.stringify(task))
        list.innerHTML += '<li onclick="clickCheck(this)" id="'+ taskID +'"><div id="checkImg"></div><p>' + item +'</p><button class="close" id="remove">X</button><hr></li>';
        removeButton();
        n++;
    }

    }
    function clickCheck(todo) {
        
            var checkedToDo = document.getElementById(todo.id);

        var name = todo.className
        if (name == "checked") {
            checkedToDo.className = ("unchecked");
    var retrievedObject = localStorage.getItem(todo.id);
    if (retrievedObject) {
    var task = JSON.parse(retrievedObject)
    task.checked = false;
    localStorage.setItem(task.id, JSON.stringify(task));
    }
        }
        else{
            checkedToDo.className = "checked";
    var retrievedObject = localStorage.getItem(todo.id);
    if (retrievedObject) {
         var task = JSON.parse(retrievedObject)
    task.checked = true;
    localStorage.setItem(task.id, JSON.stringify(task));
    }
   
        }
    }
    
    function removeChecked() {
        for (var i = 0; i < checked.length; i++) {
            var checkedElement = checked[i];
            checkedElement.style.display = "none";
            localStorage.removeItem(checkedElement.id)

        }

          
    }
    function removeAll() {
        for (var i = 0; i < allItems.length; i++) {
            var item = allItems[i];
            item.style.display = "none";
            localStorage.removeItem(item.id)

        }

          
    }
    
    function removeButton() {
         for (var i = 0; i < close.length; i++) {
            close[i].onclick = function() {
            var div = this.parentElement;
            localStorage.removeItem(this.parentElement.id)
            n--;

            div.style.display = "none";
            }
        }
    }

</script>
</body>
</html>
